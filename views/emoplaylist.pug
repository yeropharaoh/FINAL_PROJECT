html
	head
		style
			include ../style.css
		link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css')

		meta(name="viewport" content="width=device-width, initial-scale=1.0")
	body
		header
			.navbar-fixed
					nav
						.nav-wrapper.white.darken-3
							a.brand-logo(href='/') 
								img(src='https://image.ibb.co/kmB6xQ/logo4.png', style='width: 86%')

								ul#nav-mobile.right.hide-on-med-and-down
									li
										a.btn.purple.darken-4(href="/") Home
										a.btn.purple.darken-4(href="/emoplaylist") Spot-I-See
										a.btn.purple.darken-4(href="/makemusic") Make music
								ul#nav-mobile.side-nav
												li
													a(href='#') Navbar Link
								|  
								a.button-collapse(href='#', data-activates='nav-mobile')
									i.material-icons menu

		row.center
			.container1.col.s5.offset-s3
				h4.header.col.s12.light Welcome to Spot-I-See! 
					br
					| Brought to you by Microsoft's Emotion API + Spotify's API
				h7 paste an image link of a person's face below and we'll pick the right playlist that suits their emotion!
				br
				br
			.searchform.col.s6.offset-s3
				br
				input#imageinput(type="url" name='imagelink' placeholder='insert your image URL link' ) 
				br
				button.btn.btn-default#submitbutton1(type="submit", name="submit1") Click here to see the results!
								

			div(name='image' id='imageholder')
				#emotionresult
					h4 the strongest emotion is... !
			div(name='spotify' id='spotifyholder') 



		//- jQuery
		script(src='https://code.jquery.com/jquery-3.2.1.min.js')
		//- script
		//- 	include ../public/script.js
		
		script.
			$('#emotionresult').hide()

			$('#submitbutton1').on('click', function(){
			console.log('something')
			
			var image = $('#imageinput').val()
			var token = window.location.search.substr(14,159);
			
			var getPlaylist = (playlist) => $.ajax({
					url: playlist.playlist,
					method: 'GET',
					headers: {'Authorization': 'Bearer' + token}
					//- dataType: 'json',
					//- data: {
					//- 	type: 'artist',
					//- 	q: artist
					//- }
				});

				$.post('/search', { imageurl: image, access_token: token}, (result) => {
				console.log(result)
					getPlaylist(result);
					$('#imageholder').html('<img src="' + result.image + '" />' + '<h2 style="color: white">THE STRONGEST EMOTION IS..... ' + result.emotion + '</h2>')
					if(result.emotion === "happiness") {
						$('#spotifyholder').html('<iframe height="400", width="600" src="' + 'https://www.youtube.com/watch?v=y6Sxv-sUYtM' + '"></iframe>')
					}

					
				});
			});